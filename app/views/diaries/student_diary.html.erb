<% provide(:title, '過去の日記一覧') %>

<div class="student-diary-page">
    <h1 class="student-diary-page-title"><%= display_user_info(@student) %>の日記一覧</h1>
    <div class="month-navigation">
        <%= link_to '前の月', student_diary_path(@student, date: @previous_month), class: 'button' if @previous_month %>
        <span class="date-field"><%= @date.strftime('%Y年%-m月') %></span>
        <%= link_to '次の月', student_diary_path(@student, date: @next_month), class: 'button' if @next_month %>
    </div>
    <%= link_to 'さいしょに もどる', authenticated_root_path, class: 'student-diary-back-link student-diary-button-link' %>
    <%= link_to 'クラス選択', class_selection_path, class: 'student-diary-back-link student-diary-button-link' %>

  <table class="student-diary-table">
    <thead>
      <tr>
        <th>日付</th>
        <th>学校</th>
        <th>勉強</th>
        <th>休み時間</th>
        <th>給食</th>
      </tr>
    </thead>
    <tbody>
      <% @diaries.group_by(&:date).each do |date, diaries_on_date| %>
        <tr>
          <td><%= date.strftime("%-m/%-d") %> (<%= japanese_wday(date) %>)</td>
          <% [1, 2, 3, 4].each do |question_num| %>
            <% answer = diaries_on_date.find { |d| d.question_num == question_num } %>
            <td class="student-diary-column <%= emotion_class(answer&.emotion_num) %>">
              <%= image_tag(answer&.answer_image, alt: 'emotion') if answer %>
            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
